#!/usr/bin/env bash
set -euo pipefail

# ---------- Colored Logging Functions ----------
info() { echo -e "\033[0;36m[i]\033[0m $*"; }
warn() { echo -e "\033[1;33m[!]\033[0m $*"; }
success() { echo -e "\033[0;32m[✔]\033[0m $*"; }
error() { echo -e "\033[0;31m[✘]\033[0m $*" >&2; }

# ---------- Variables ----------
OS_ID="{{ .osid | lower }}"

# ---------- APT Install Function ----------
install_apt_packages() {
    info "Detected Debian-based system. Installing packages using APT..."

    info "Updating package list (apt update)..."
    sudo apt update -qq -y

    {{- range .packages.debian.apt }}
    info "Installing: {{ . }}"
    sudo apt install -y -qq {{ . | quote }}
    {{- end }}

    success "All packages installed successfully via APT."
}

# ---------- User Prompt ----------
info "Current OS: $OS_ID"
read -p "Do you want to install packages? [Y/n] " answer
case "$answer" in
[Nn]*)
    info "Installation aborted."
    exit 0
    ;;
*) info "Proceeding with package installation..." ;;
esac

# ---------- Main Install Dispatcher ----------
if [[ "$OS_ID" == *"debian"* || "$OS_ID" == *"ubuntu"* ]]; then
    install_apt_packages
fi
